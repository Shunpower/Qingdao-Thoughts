Developed by Shunpower, StayAlone, Zelotz, H_Z_J, LPhang, WaterSun

### 思考题 1：介值定理
有 $n$ 个物品，每个物品有重量 $w_i$ 和体积 $v_i$ 且密度均匀。你可以切物品，每次可以选一个物品切成两部分，也就是选一个 $0$ 到 $1$ 的实数 $k$ 把物品分成 $k$ 和 $(1-k)$ 比例的两个物品。

你有最多 $X$ 次切的机会。

1. 要想保证切完之后一定能把物品分成两组使得两组重量和相等，体积和也相等，$X$ 至少是几。
2. 设计高效算法求问题 1 的方案。
3. 如果是分成三组呢？
4. （问题 0）如果是要把物品分成两组使得两组数量相同且体积和也相等呢（不考虑重量）？

### Solution

介值定理：若函数 $f(x)$ 是一个连续函数，满足 $l\leq r$ 和 $val \in [f(l), f(r)]$ ，一定能取到至少一个 $x$ 满足 $f(x)=val$ 。

#### 问题 1

首先，我们可以举出反例，证明只切一次是不行的：
$$
\begin{matrix}
v_i \ \ \ w_i \\
1   \ \ \ 10  \\
10  \ \ \ 1   \\
\end{matrix}
$$
在这种情况下， $v_2 > \frac{\sum v} 2$ ， $w_1 > \frac{\sum w} 2$ ，至少也得切两次。
我们考虑将所有物品按照等单位的体积 $v_i$ 排成一环，考虑一条直径把整个环分成左右两个区域，此时左右区域的体积一定相等。
我们设左右区域的重量分别为 $x$ 和 $y$ 。
以这条直径为法线，以圆心为轴心，我们增大夹角 $\theta$ ，旋转直径，会将整个环分成两个部分，最后 $x$ 和 $y$ 的值将会互换。
根据介值定理， $x$ 和 $y$ 是连续变化的，因此在变化的过程中， $x=y$ 的时刻一定会出现。由此得证，切两次的一定可以。

#### 问题 2

[TBA]

### 思考题 2：平衡 / 树分治

对一个序列 $a_1\cdots a_n$，找一个位置 $x$，使得 $a_1+\cdots+a_x$ 和 $a_{x+1}+\cdots+a_n$ 的比值在 $[\frac{1}{c},c]$ 之间，要求 $c$ 尽可能小。
 
1. $c$ 最大情况下是多少，并构造对应 $c$ 的例子。
2. 如果允许将某一个 $a_i$ 原位切开成两个相邻的位置，这两个位置的权值均为整数且加起来是 $a_i$ 且任意分配，$c$ 最大情况下是多少，当 $n$ 很大并且 $a_i\ge 1$ 的情况下，$c$ 会变小吗？

对一棵 $n$ 个点的树，找一条边，使得这条边断开后，两边的连通子图的点数比值在 $[\frac{1}{c},c]$ 之间，要求 $c$ 尽可能小。
 
3. $c$ 最大情况下是多少，并构造对应 $c$ 的例子。
4. 如果树是一棵二叉树，对任意一个给定的 $n$，$c$ 最大情况下是多少，并给出一个通用的构造对应 $c$ 的例子的算法。
 
在树的基础上，如果给定一个结点 $x$，将 $x$ 删去后剩下若干个连通子图，将这些连通子图分成两组，使得两组点数的比值在 $[\frac{1}{c},c]$ 之间，要求 $c$ 尽可能小。
 
5. $c$ 最大情况下是多少，并构造对应 $c$ 的例子。
6. 如果结点 $x$ 是你自己选定的，$c$ 最大情况下是多少，并构造一个通用算法。

### Solution

#### 问题 1

考虑到没有提供值域范围，所以设置 $a_1=+\infty$ 即可使得 $c=+\infty$。

#### 问题 2

定义 $sum=\sum a_i$。

简单题，但是**不能使用介值定理。**

考虑由于切分只能切分成两个整数，所以表示两边比值的函数 $f(x)$ 并不是连续的。

但是我们可以先考虑连续情况下的问题。切分连续情况下，我们必然可以将其在 $\frac{sum}{2}$ 处切分为两半，从而对于任意序列答案均为下界 $1$。其中，若 $sum$ 为偶数，则不会发生切分或被切分的 $a_i$ 将产生两个整数；反之若为奇数，被切分的 $a_i$ 将产生 $\frac{1}{2}$ 大小的零碎部分。

现在我们考虑切分不连续。首先对于 $sum$ 为偶数，下界 $1$ 仍然可以取到。而对于奇数，我们容易证明仍然在 $l=\left\lfloor\frac{sum}{2}\right\rfloor$ 或 $r=\left\lceil\frac{sum}{2}\right\rceil$ 处切分最优，因为这两处相邻点的答案显然相等，而将 $l$ 向左调整或将 $r$ 向右调整答案均不优。

#### 问题 3

最坏情况下我们希望无论怎么切两个连通子图都其中一边是一个叶子，剩下的部分是除了这个叶子的整棵树，所以菊花图非常合适。对于菊花图，$c=n-1$ 且显然是答案的上界。

这就是卡直接应用边分治的方法。边分治希望删掉一条边使得两个连通子图的大小尽量接近，然而菊花图上直接应用边分治的复杂度是错的。

#### 问题 4

答案是 $2$。这个值是容易构造证明可取的：我们构造一个每条链等长的三叶草即可。

我们考虑证明这是上界。也就是说，我们只需要证明不存在一种树的形态使得找到最小的边比 $2$ 大。

考虑序列与二叉树性质的不同点：序列上的每个点都是至多二度的，而二叉树上每个点都是至多三度的。

考虑二叉树上的二度点 $v$：$u_1\leftrightarrow v\leftrightarrow u_2$。对于这种情况，类似序列，我们总是可以通过调整使得答案减小（总是可以让一个连通子图少一个点，另一个多一个点，让多的那个少即可），让答案趋近于下界 $1$。

我们考虑三度点 $v$（连向 $u_1,u_2,u_3$）。假设在某条边上答案 $>2$，那么说明目前有两个连通子图的节点数量和（假设是 $siz_{u_1}$ 和 $siz_{u_2}$）超过另一个连通子图的两倍（假设是 $siz_{u_3}$）。那么考虑：

$$
\begin{aligned}
&2siz_{u_3}<siz_{u_1}+siz_{u_2}\\\iff& siz_{u_3}<\frac{siz_{u_1}+siz_{u_2}}{2}\\\iff& siz_{u_3}<\max(siz_{u_1},siz_{u_2})
\end{aligned}
$$

我们考虑捆绑 $siz_{u_3}$ 和 $\min(siz_{u_1},siz_{u_2})$，显然 $siz_{u_3}+\min(siz_{u_1},siz_{u_2})<\max(siz_{u_1},siz_{u_2})$，所以答案就一定会变小。综上，答案不可能 $>2$。

这就是边分治[三度化](https://oi-wiki.org/graph/tree-divide/#%E8%BE%B9%E5%88%86%E6%B2%BB)的原理。边分治通过把多叉树用三度化转换成二叉树保证只要边找得好每次切分就肯定可以把树规模缩小一半，从而保证复杂度正确。

#### 问题 5

答案是 $+\infty$。我们考虑搞一个很大的子树和一个叶子，二叉地接在 $x$ 上，即可构造得到。

#### 问题 6

答案也是 $2$。

我们对多叉树应用常规的三度化（搞一条虚点链，每个虚点上一个叉接一个实点儿子子树，另一个叉往下接），这样我们的一个分组就转化为选择一条边断开（要么是实点虚点边要么是虚点虚点边），且整个树转成了一个二叉树，从而等价于问题 4。由于对于任意实点儿子子树在虚点链上的排列方式答案都只能做到 $2$，从而对于任意分组方式答案都只能做到 $2$。

我们考虑用这个证明直接对任意树应用点分治总可以做到复杂度正确。考虑我们找到一个很好的点做根，满足可以把它的子树分成 $1:2$ 的两半，那么每一半又可以继续划分（具体的，建立一个虚点把那些子树合起来就能规约回来），从而每个儿子子树几乎均分整个子树。显然这种点不可能只有一个子树（对于 $n$ 足够大），所以每次子树大小至少折半，从而点分治复杂度正确。

### 思考题 3：旋转扫描线

二维平面上有 $n$ 个点，要求这些点互相不重合，并且三点不共线，编号为 $[1,n]$，现在我们要画一条直线，如果一个点 $(x,y)$ 满足 $Ax+By+C\ge0$，则视为点 $(x,y)$ 在直线 $Ax+By+C=0$ 的上方。将直线上方的点看做是一个集合。

1. 如果 $n$ 个点的坐标由你来构造，对直线 $Ax+By+C=0$，假设 $A,B,C$ 取遍所有实数，最多可以得到多少个不同的集合。
2. 如果有若干条直线，其上方点的集合相同，是否可以通过对这些直线进行旋转和平移，使得这些直线变成同一条直线。
3. 如果改变你在问题 1 中构造的点的坐标，不同的集合数是否会发生改变。
4. 给定点 $(x,y)$，对于所有过 $(x,y)$ 的直线，是否一定存在一条直线，使得直线两侧的点数最多只差 $1$，这里的点数不统计 $(x,y)$，如果点在直线上，由你决定属于哪一侧。
5. 是否可以找到两条相交的直线，使得给定的 $n$ 个点被分成四个点集，且最大的点集和最小的点集大小最多差 $1$，如果点在直线上，由你决定属于哪一个点集。
6. 是否可以找到三条共点的直线，使得给定的 $n$ 个点被分成六个点集，且最大的点集和最小的点集大小最多差 $1$，如果点在直线上，由你决定属于哪一个点集。

### Solution

[TBA]

### 思考题 4：区间最大子段和

区间最大子段和问题：给定一个长为 $n$ 的整数列 $\{a_i\}$（有正有负），每次查询一个区间，问这个区间的所有子区间中，区间和最大的是多少。

1. 如果有一种修改是全局加同一个数，且只有全局查询，如何维护。（考虑，所有可能的答案区间有哪些？）
2. 如果有一种修改是全局加同一个数，且所有询问区间都是后缀（右端点都是 $n$），如何维护。
3. 给定一个长为 $n$ 的整数列 $\{a_i\}$（有正有负），求出每个后缀的平均值最小的前缀。【ABC341G】
4. 给定一个长为 $n$ 的整数列 $\{a_i\}$（有正有负），区间加，区间查询平均值最小且长度不小于 $k(k\le 10)$ 的子区间。
问题5. 区间加正数，区间最大子段和。（考虑能否用组合方法证明复杂度？）【P5693】

### Solution

[TBA]

### 思考题 5（还没讲）

有一个 $n$ 阶排列 ${a_i}$，定义 $f([l,r])=[\min(a_l,\dots ,a_r), \max(a_l, \dots, a_r)]$。

0. 对一个初始区间不断迭代 $[l,r], f([l,r]), f(f([l,r])),\dots$，如何刻画这个过程。
1. 对输入的 $[l,r]$，设计一个尽可能高效的算法判定多次迭代 $f$ 能否达到 $[1,n]$
2. 对输入的 $[l,r]$，如果可以迭代达到 $[1,n]$，设计算法求出最少需要迭代 $f$ 多少次。（CF1707E）
3. 对任意一个 $[l,r]$，不断迭代 $f$ 可达到的不同区间个数的（渐进）上界是多少？（也是上个问题答案的上界）
4. 如果给定的 $a$ 不是排列，而是一个值域 $1$ 到 $n$ 的数组，数值可以重复出现，问题3的答案会有变化吗？（CF1707E）
5. 如果多次区间询问有多少个子区间可以在有限步内迭代到 $[1,n]$，能做吗？
6. 如果多次区间询问有多少个子区间可以在有限步内迭代回到自身，能做吗？

### Solution

#### 问题 0

定义一个极大的区间 $[l,r]$ 满足 $f([l,r])=[l,r]$。不难发现极大的一个区间满足区间 $[l,r]$ 的值域在 $[l,r]$，除了长度为 $1$ 的区间相当于在置换环上一直跳，一个非极大的区间，经过不断的迭代一定可以到达一个极大的区间，然后停止改变。

#### 问题 1

显然两个极大的区间拼在一起的时候也构成极大的区间，故 $[1,n]$ 显然为极大的区间。一个区间 $[l,r]$ 可以迭代到 $[1,n]$ 说明没有比 $[1,n]$ 更小的极大的区间包含 $[l,r]$，所以不难发现端点 $l$ 处于最左边的极大的区间中，端点 $r$ 处于最右边的极大的区间中，$\mathcal{O}(n)$ 处理极大的区间并判断即可。

#### 问题 2

对于任意区间，因为是排列，所以值域差大于等于区间长度，而对于一个极大的区间，每个真子区间的值域差一定大于区间长度，因此每次迭代都会使区间长度变大，最多迭代 $n$ 次，使用 $\text{ST}$ 表模拟即可计算。当然，对于长度为 $1$ 的区间因为是跳置换环，所以也不超过 $n$ 次。

#### 问题 3

由上一问，显然为包含区间 $[l,r]$ 的最小的极大区间的长度。



[TBA]

### 思考题 6：$\pm1$ 前缀和 / 众数

给你一个由 $+1$ 和 $-1$ 构成的序列，其中 $+1$ 的个数只有 $x$ 个，$-1$ 的个数有 $n-x$ 个。$x$ 默认远小于 $n$。

1. 最多有多少个前缀，满足前缀和 $\ge 0$？满足前缀和 $\ge0$ 的前缀最多的情况下，有多少种不同的序列？
2. 如果要求所有的前缀和都 $\ge0$，有多少种不同的序列？
3. 最多有多少个区间，满足区间和 $\ge0$？并给出对应的构造。
4. 对于序列中的一个位置 $i$，假设对任意包含 $i$ 的区间 $[l,r]$，该区间的和都 $<0$，这样的 $i$ 需要满足什么条件？

在原问题的基础上，定义一个序列的价值为：找出所有满足区间和 $>0$ 的区间 $[l_i,r_i]$，对这些区间求并。

5. 对所有可能的序列，最大的价值是多少？
6. 对于一个给定的序列，输入格式为所有 $+1$ 的位置，如何在 $\mathcal O(x\log n)$ 时间复杂度内求出该序列的价值？这里需要考虑 $x$ 远小于 $n$。

接下来回到原问题。

7. 对于一个给定的序列，假设 $x$ 最大和 $n$ 同阶，我们想求出有多少区间的和 $\ge0$，是否存在 $\mathcal O(n)$ 的算法？请给出一个 $\mathcal O(n)$ 的算法，或者尝试归约一个已知 $\mathcal O(n)$ 困难的问题。【P3770】
8. 如果问题 6 存在 $\mathcal O(n)$ 的算法，那么对于一个给定的序列，假设 $x$ 远小于 $n$，输入格式为所有 $+1$ 的位置，我们想求出有多少区间的和 $\ge0$，是否存在 $\mathcal O(x)$ 的算法？
9. 可以用这个方法尝试 $\mathcal O(n\log n)$ 解决 P4062，CF1446D2。

### Solution

[TBA]